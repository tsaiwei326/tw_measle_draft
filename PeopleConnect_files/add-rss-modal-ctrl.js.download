var addRssFeedController = angular.module('addRssFeedController', ['ui.bootstrap']);
addRssFeedController.controller('addRssFeedCtrl', function ($scope, $uibModalInstance, RssService, user) {

	var $ctrl = this;
	var self = $scope;

	$ctrl.selectedFeeds = {};
	$ctrl.tools = [];

	$ctrl.isLoadingFeed = false;

	self.user = user;

	var params = {
		userTableAutogeneratedId: self.user.id
	};

	RssService.getMyFeeds(params).then(function (response) {
		console.log(response);
		$ctrl.RSSFeeds = response.data;
	}).catch(function (err) {
		console.log(err);
	}).finally(function () {
		$ctrl.isLoadingFeed = false;
	});

	$ctrl.addNewFeed = function () {

        //console.log('adding', $ctrl.newUrl);
        //console.log('adding', $ctrl.newLinktext);

		var data = [{ "RssFeedUrl": $ctrl.newUrl }];

		RssService.addFeedUrl(data, params)
            .then(function (response) {
            	console.log(response);
            	$uibModalInstance.close();
            }).catch(function (response) {
            	console.log(response);
            });
	};

	$ctrl.removeRss = function (rss) {
		console.log(rss);

		let index = $ctrl.RSSFeeds.indexOf(rss);

		if (index != -1) {
			$ctrl.RSSFeeds.splice(index, 1);
		}

		var data = [{ "AutogeneratedRssId": rss.AutogeneratedRssId }];

		RssService.removeFeedUrl(data, params).then(function (response) {
			console.log(response);
		}).catch(function (response) {
			console.log(response);
		});
	};

	$ctrl.cancel = function () {
		$uibModalInstance.dismiss(false);
	};
});